{% extends 'products/base.html' %}
{% load humanize %}

{% block title %}Chi ti·∫øt ƒë∆°n h√†ng #{{ order.id }}{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>üì¶ Chi ti·∫øt ƒë∆°n h√†ng #{{ order.id }}</h2>
        <a href="{% url 'order_management' %}" class="btn btn-outline-secondary">‚Üê Quay l·∫°i</a>
    </div>

    <!-- Th√¥ng tin ƒë∆°n h√†ng -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Th√¥ng tin kh√°ch h√†ng</h5>
                </div>
                <div class="card-body">
                    <p><strong>H·ªç t√™n:</strong> {{ order.customer_name }}</p>
                    <p><strong>S·ªë ƒëi·ªán tho·∫°i:</strong> {{ order.phone }}</p>
                    <p><strong>ƒê·ªãa ch·ªâ giao h√†ng:</strong> {{ order.address }}</p>
                    {% if order.user %}
                        <p><strong>T√†i kho·∫£n:</strong> <span class="badge bg-info">{{ order.user.username }}</span></p>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">Th√¥ng tin ƒë∆°n h√†ng</h5>
                </div>
                <div class="card-body">
                    <p><strong>T·ªïng ti·ªÅn:</strong> 
                        <span class="text-success fw-bold fs-5">{{ order.total_amount|intcomma }} ‚Ç´</span>
                    </p>
                    <p><strong>H√¨nh th·ª©c thanh to√°n:</strong>
                        {% if order.payment_method == 'cod' %}
                            <span class="badge bg-primary">Thanh to√°n khi nh·∫≠n h√†ng</span>
                        {% else %}
                            <span class="badge bg-info">Chuy·ªÉn kho·∫£n ng√¢n h√†ng</span>
                        {% endif %}
                    </p>
                    <p><strong>Tr·∫°ng th√°i:</strong>
                        {% if order.status == 'pending' %}
                            <span class="badge bg-warning text-dark">Ch·ªù x√°c nh·∫≠n</span>
                        {% elif order.status == 'confirmed' %}
                            <span class="badge bg-info">ƒê√£ x√°c nh·∫≠n</span>
                        {% elif order.status == 'delivered' %}
                            <span class="badge bg-success">ƒê√£ giao</span>
                        {% else %}
                            <span class="badge bg-danger">ƒê√£ h·ªßy</span>
                        {% endif %}
                    </p>
                    <p><strong>Th·ªùi gian ƒë·∫∑t:</strong> {{ order.created_at|date:"d/m/Y H:i" }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Danh s√°ch s·∫£n ph·∫©m -->
    <div class="card mb-4">
        <div class="card-header">
            <h5>Danh s√°ch s·∫£n ph·∫©m</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>S·∫£n ph·∫©m</th>
                            <th>Gi√°</th>
                            <th>S·ªë l∆∞·ª£ng</th>
                            <th>Th√†nh ti·ªÅn</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in order.items.all %}
                        <tr>
                            <td>{{ item.fruit_name }}</td>
                            <td>{{ item.price|intcomma }} ‚Ç´</td>
                            <td>{{ item.quantity }}</td>
                            <td class="fw-bold">{{ item.total_price|intcomma }} ‚Ç´</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    <tfoot>
                        <tr>
                            <th colspan="3" class="text-end">T·ªïng c·ªông:</th>
                            <th class="text-success fs-5">{{ order.total_amount|intcomma }} ‚Ç´</th>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

    <!-- C·∫≠p nh·∫≠t tr·∫°ng th√°i (ch·ªâ admin) -->
    <div class="card">
        <div class="card-header">
            <h5>C·∫≠p nh·∫≠t tr·∫°ng th√°i</h5>
        </div>
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                <div class="mb-3">
                    <label class="form-label">Thay ƒë·ªïi tr·∫°ng th√°i ƒë∆°n h√†ng</label>
                    <select name="status" class="form-select">
                        <option value="pending" {% if order.status == 'pending' %}selected{% endif %}>Ch·ªù x√°c nh·∫≠n</option>
                        <option value="confirmed" {% if order.status == 'confirmed' %}selected{% endif %}>ƒê√£ x√°c nh·∫≠n</option>
                        <option value="delivered" {% if order.status == 'delivered' %}selected{% endif %}>ƒê√£ giao</option>
                        <option value="cancelled" {% if order.status == 'cancelled' %}selected{% endif %}>ƒê√£ h·ªßy</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">C·∫≠p nh·∫≠t tr·∫°ng th√°i</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}